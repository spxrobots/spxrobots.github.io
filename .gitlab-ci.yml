image: debian

.build-script: &build-script
  - apt update
  - apt install --quiet --assume-yes bash curl
  - curl -L 'https://github.com/mgdm/htmlq/releases/download/v0.4.0/htmlq-x86_64-linux.tar.gz' > 'htmlq-x86_64-linux.tar.gz'
  - tar -xf 'htmlq-x86_64-linux.tar.gz'
  - chmod +x htmlq
  - export PATH="$PWD:$PATH"
  - bash gdrive-img.bash

build:
  script:
  - *build-script
  rules:
    - if: $CI_COMMIT_REF_NAME != $CI_DEFAULT_BRANCH

pages:
  stage: deploy
  script:
  - *build-script
  artifacts:
    paths:
    - public
    expire_in: 1 day
  rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
